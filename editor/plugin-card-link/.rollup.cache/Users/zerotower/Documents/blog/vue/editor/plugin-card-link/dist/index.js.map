{"version":3,"file":"index.js","sourceRoot":"","sources":["../src/index.ts"],"names":[],"mappings":"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","sourcesContent":["import type { BytemdPlugin, BytemdViewerContext } from \"bytemd\";\nimport { visit } from \"unist-util-visit\";\nimport { v4 as uuidv4 } from \"uuid\";\n\nexport type Locale = {};\n\nexport type ExcludeItem = string | RegExp;\n\nconst TEMP_LINK_CLASS = \"link-temp-to-be-card\";\nconst LINK_CLASS = \"zt-bookmark-link\";\nexport interface WebInfo {\n  title: string;\n  desc: string;\n  icon: string;\n  baseUrl: string;\n  host: string;\n  url: string;\n}\n\nexport interface ByteMDPluginCardLinkOptions {\n  /**\n   * switch languages as you like.\n   */\n  locale?: Locale;\n  /**\n   * indicate links which don't need to transform.\n   */\n  exclude?: ExcludeItem | ExcludeItem[];\n  /**\n   * will be using to fetch the info of web\n   */\n  loadInfoApi?: (url: string) => Promise<Partial<WebInfo>>;\n  /**\n   * define the value of the property [href] of a element,\n   * default: blank\n   */\n  openMode: \"self\" | \"blank\";\n  /**\n   * when loadInfoApi timeout>= options.timeout, using default data\n   * default: 30s\n   */\n  timeout?: number;\n  /**\n   * will be using then webinfo hasn't the icon property or loading icon occur error.\n   * default: https://bpic.588ku.com/element_origin_min_pic/00/72/81/9356def45e71de5.jpg\n   */\n  defaultIcon?: String;\n\n  /**\n   * skeleton card root class, you can use it to change the styles of skeleton card.\n   */\n  skeletonWrapClass?: string;\n  /**\n   * data card root class, you can use it to change the styles of data card\n   */\n  dataWrapClass?: string;\n}\n\nconst observerMap = new WeakSet<HTMLLinkElement>();\n\nexport default function cardLink(\n  options: ByteMDPluginCardLinkOptions = {\n    openMode: \"blank\",\n  },\n): BytemdPlugin {\n  const {\n    defaultIcon = \"https://bpic.588ku.com/element_origin_min_pic/00/72/81/9356def45e71de5.jpg\",\n    openMode = \"blank\",\n    skeletonWrapClass,\n    dataWrapClass,\n    loadInfoApi,\n    timeout = 30 * 1000,\n  } = options ?? {};\n  function renderSkeletonCard(link: string) {\n    const root = document.createElement(\"div\");\n    addClass(root, \"zt-card-bookmark loading\");\n    if (skeletonWrapClass) {\n      const getClass = skeletonWrapClass.split(\" \").shift() as string;\n      if (!hasClass(root, getClass)) {\n        addClass(root, getClass);\n      }\n    }\n    root.innerHTML = `<a class=\"zt-card-bookmark-link\" href=\"${link}\" target=\"${options.openMode === \"self\" ? \"_self\" : \"_blank\"}\">\n    <div class=\"zt-card-bookmark-details\">\n      <div class=\"zt-card-bookmark-content\">\n      <div class=\"zt-card-bookmark-image\"></div>\n      <div class=\"zt-card-bookmark-body\">\n      <div class=\"zt-card-bookmark-title\"></div>\n      <div class=\"zt-card-bookmark-desc\"></div>\n      </div>\n    </div>\n   </div></a>`;\n    return root;\n  }\n\n  //render data card\n  function renderDataCard(data: Partial<WebInfo>, defaultDesc?: string) {\n    const root = document.createElement(\"div\");\n    const uid = uuidv4();\n    if (!data.desc) {\n      data.desc = defaultDesc ?? \"\";\n    }\n    addClass(root, \"zt-card-bookmark\");\n    if (dataWrapClass) {\n      const getClass = dataWrapClass.split(\" \").shift() as string;\n      if (!hasClass(root, getClass)) {\n        addClass(root, getClass);\n      }\n    }\n    root.innerHTML = `<a class=\"zt-card-bookmark-link\" href=\"${data.url}\" target=\"${options.openMode === \"self\" ? \"_self\" : \"_blank\"}\">\n    <div class=\"zt-card-bookmark-details\">\n      <div class=\"zt-card-bookmark-content\">\n      <img data-uid=\"${uid}\" class=\"zt-card-bookmark-image\" src=\"${data.icon}\" alt=\"icon\" />\n      <div class=\"zt-card-bookmark-body\">\n      <div class=\"zt-card-bookmark-title\">\n      ${data?.title ?? data?.desc}\n</div>\n      <div class=\"zt-card-bookmark-desc\">${data?.desc ?? data.url}</div>\n      </div>\n    </div>\n   </div></a>`;\n    setTimeout(() => {\n      const imgEl = document.querySelector(`img[data-uid=\"${uid}\"]`);\n      if (imgEl) {\n        (imgEl as HTMLImageElement).addEventListener(\"error\", (e) => {\n          iconLoadError(e);\n        });\n      }\n    }, 0);\n    return root;\n  }\n\n  //when image load error, using defaultIcon,\n  // you must be sure the defaultIcon can be loaded successfully.\n  function iconLoadError(e: Event) {\n    const el = e.target as HTMLImageElement;\n    el.setAttribute(\"src\", defaultIcon as string);\n    el.removeEventListener(\"error\", iconLoadError);\n  }\n  //deal link to card\n  function renderCard(aEl: HTMLLinkElement) {\n    const url = aEl?.getAttribute(\"href\") ?? \"\";\n    //not validated link, do nothing\n    if (!isHttpOrHttps(url)) return;\n    //add link class\n    if (!hasClass(aEl, LINK_CLASS)) {\n      addClass(aEl, LINK_CLASS);\n    }\n    const defaultDesc = aEl?.textContent ?? url;\n    const emptyCardRoot = renderSkeletonCard(url);\n    aEl.replaceWith(emptyCardRoot);\n    const defaultWebInfo: Partial<WebInfo> = {\n      title: defaultDesc,\n      url: url,\n      icon: defaultIcon as string,\n      desc: url,\n    };\n    const task = new Promise<Partial<WebInfo>>((resolve, reject) => {\n      loadInfoApi?.(url).then(\n        (data) => {\n          resolve({\n            ...defaultWebInfo,\n            ...data,\n          });\n        },\n        () => {\n          resolve(defaultWebInfo);\n        },\n      );\n      setTimeout(() => {\n        resolve(defaultWebInfo);\n      }, timeout);\n    });\n    task.then((data) => {\n      emptyCardRoot.replaceWith(renderDataCard(data));\n    });\n  }\n  return {\n    remark: (p) => {\n      p.use(() => (tree, vFile) => {\n        visit(tree, \"link\", (node: Record<string, any>, index, parent) => {\n          //match to exclude option, or doesn't be http(s) link, don't need to transform.\n          if ((options.exclude && isExclude(options.exclude, node.url)) || !isHttpOrHttps(node.url)) {\n            return;\n          }\n          const url = node.url as string;\n          let defaultText = \"\";\n          if ((node.children?.[0]?.type ?? \"\") === \"text\") {\n            defaultText = node.children[0]?.value ?? \"\";\n          }\n          const children: Record<string, any>[] = [\n            {\n              type: \"text\",\n              value: defaultText,\n            },\n            {\n              type: \"element\",\n              tagName: \"a\",\n              properties: {\n                className: TEMP_LINK_CLASS,\n                href: url,\n              },\n              children: [\n                {\n                  type: \"text\",\n                  value: defaultText,\n                },\n              ],\n            },\n          ];\n          if (!node.data) node.data = {};\n          node.data.hName = \"span\";\n          node.data.hChildren = children;\n        });\n        return tree;\n      });\n      return p;\n    },\n    viewerEffect({ markdownBody }): void | (() => void) {\n      const eles = document.getElementsByClassName(TEMP_LINK_CLASS) as HTMLCollectionOf<HTMLLinkElement>;\n      if (window.IntersectionObserver) {\n        const intersectionObserver = new IntersectionObserver((entries, observer) => {\n          entries.forEach((entry) => {\n            if (entry.intersectionRatio <= 0) return;\n            renderCard(entry.target as HTMLLinkElement);\n            //remove from observer\n            intersectionObserver.unobserve(entry.target);\n          });\n        });\n        Array.from(eles).forEach((ele) => {\n          if (observerMap.has(ele)) return;\n          intersectionObserver.observe(ele);\n          observerMap.add(ele);\n        });\n        console.log(intersectionObserver.takeRecords());\n      } else {\n        Array.from(eles).forEach((ele) => {\n          renderCard(ele);\n        });\n      }\n    },\n  };\n}\n\nfunction isExclude(exclude: ExcludeItem | ExcludeItem[], link: string): boolean {\n  if (Array.isArray(exclude)) {\n    return exclude.some((item) => isExclude(item, link));\n  } else {\n    return isRegExp(exclude) ? regexpCheck(exclude as RegExp, link) : stringCheck(exclude as string, link);\n  }\n\n  function regexpCheck(reg: RegExp, link: string) {\n    return reg.test(link);\n  }\n  function stringCheck(excludeStr: string, link: string) {\n    return excludeStr === link;\n  }\n}\n\nfunction isRegExp(val: any) {\n  const res = Object.prototype.toString.call(val);\n  return res.substring(8, res.length - 1) === \"RegExp\";\n}\n\nfunction isHttpOrHttps(link: string) {\n  return /^http(s)*/.test(link);\n}\n\nexport const classNameToArray = (cls = \"\") => cls.split(\" \").filter((item) => !!item.trim());\nexport const hasClass = (el: Element, cls: string): boolean => {\n  if (!el || !cls) return false;\n  if (cls.includes(\" \")) throw new Error(\"className should not contain space.\");\n  return el.classList.contains(cls);\n};\n\nexport const addClass = (el: Element, cls: string) => {\n  if (!el || !cls.trim()) return;\n  el.classList.add(...classNameToArray(cls));\n};\n\nexport const removeClass = (el: Element, cls: string) => {\n  if (!el || !cls.trim()) return;\n  el.classList.remove(...classNameToArray(cls));\n};\n"]}